<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>UHAS Medical Students Residential Data</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
:root {
  --primary:#1a5fb4;
  --secondary:#1c71d8;
  --accent:#2ec27e;
  --danger:#c9190b;
  --warning:#e5a50a;
}
*{box-sizing:border-box;margin:0;padding:0}
body{
  font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
  background:#f5f7fa;
  max-width:800px;
  margin:auto;
  padding:15px;
}
.app-container{
  background:#fff;
  border-radius:15px;
  box-shadow:0 5px 20px rgba(0,0,0,.1);
  overflow:hidden;
  min-height:100vh;
}
.app-header{
  background:linear-gradient(135deg,var(--primary),var(--secondary));
  color:#fff;
  padding:25px;
  text-align:center;
}
h1{font-size:22px}
.subtitle{font-size:13px;opacity:.9}
.sync-status{
  position:absolute;top:15px;right:15px;
  background:#fff;padding:6px 12px;
  border-radius:20px;font-size:12px;
  display:flex;align-items:center;gap:6px;
}
.sync-status.online{border:1px solid var(--accent);color:var(--accent)}
.sync-status.offline{border:1px solid var(--warning);color:var(--warning)}
.form-container{padding:20px}
.section{margin-bottom:25px;border-bottom:2px solid #eee;padding-bottom:15px}
.section-title{color:var(--primary);font-size:16px;margin-bottom:15px}
.form-group{margin-bottom:15px}
label{font-weight:600;font-size:14px;margin-bottom:6px;display:block}
input,select,textarea{
  width:100%;padding:12px;border-radius:8px;
  border:2px solid #e0e0e0;font-size:15px
}
input:focus,select:focus,textarea:focus{
  outline:none;border-color:var(--primary)
}
.search-results{
  position:absolute;background:#fff;
  border:2px solid var(--primary);
  border-radius:8px;max-height:200px;
  overflow:auto;display:none;z-index:100
}
.search-item{padding:10px;border-bottom:1px solid #eee;cursor:pointer}
.search-item:hover{background:#f5f9ff}
.student-info{display:none;background:#f8fafc;padding:15px;border-radius:8px}
.blocks-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
.block-btn{
  padding:14px;border:2px solid #ddd;
  border-radius:8px;text-align:center;
  cursor:pointer;font-weight:600
}
.block-btn.selected{
  background:#f0f7ff;border-color:var(--primary);color:var(--primary)
}
.rooms-grid{
  display:grid;grid-template-columns:repeat(5,1fr);
  gap:8px;background:#f9f9f9;
  padding:10px;border-radius:8px
}
.room-btn{
  padding:10px;border:1px solid #ccc;
  border-radius:6px;text-align:center;
  cursor:pointer
}
.room-btn.selected{
  background:var(--primary);color:#fff;border-color:var(--primary)
}
.action-buttons{display:grid;gap:10px;margin-top:25px}
.btn{
  padding:15px;border:none;border-radius:10px;
  font-size:15px;font-weight:600;cursor:pointer
}
.btn-primary{background:var(--primary);color:#fff}
.btn-secondary{background:#eee}
.toast{
  position:fixed;bottom:20px;left:50%;
  transform:translateX(-50%) translateY(100px);
  background:var(--primary);color:#fff;
  padding:14px 20px;border-radius:8px;
  transition:.3s;z-index:1000
}
.toast.show{transform:translateX(-50%) translateY(0)}
.loading{
  position:fixed;inset:0;background:rgba(255,255,255,.9);
  display:none;align-items:center;justify-content:center;
  flex-direction:column;z-index:1000
}
.loading-spinner{
  width:40px;height:40px;border:4px solid #eee;
  border-top:4px solid var(--primary);
  border-radius:50%;animation:spin 1s linear infinite
}
@keyframes spin{to{transform:rotate(360deg)}}
</style>
</head>

<body>
<div class="app-container">

<div class="sync-status online" id="syncStatus">
<i class="fas fa-wifi"></i><span id="statusText">Loading…</span>
</div>

<div class="app-header">
<h1>UHAS ASOGLI HALL</h1>
<p class="subtitle">Medical Students Residential Data</p>
</div>

<div class="form-container">
<form id="auditForm">

<div class="section">
<h2 class="section-title">Executive Details</h2>
<div class="form-group">
<label>Your Name</label>
<input id="executiveName" required>
</div>
<div class="form-group">
<label>Executive ID</label>
<input id="executiveID" required>
</div>
<div class="form-group">
<label>Date</label>
<input type="date" id="auditDate" required>
</div>
</div>

<div class="section">
<h2 class="section-title">Find Student</h2>
<div class="form-group" style="position:relative">
<input id="studentSearch" placeholder="Search by ID or Name">
<div class="search-results" id="searchResults"></div>
</div>
<div class="student-info" id="studentInfo">
<input id="studentID" readonly>
<input id="studentName" readonly>
<input id="studentLevel" readonly>
<input id="studentProgramme" readonly>
</div>
</div>

<div class="section">
<h2 class="section-title">Hostel Assignment</h2>
<div class="blocks-grid">
<div class="block-btn" data-block="DOME">DOME</div>
<div class="block-btn" data-block="HLIHA">HLIHA</div>
<div class="block-btn" data-block="BANKOE">BANKOE</div>
<div class="block-btn" data-block="AHOE">AHOE</div>
</div>
<div class="rooms-grid" id="roomsGrid"></div>
</div>

<div class="action-buttons">
<button class="btn btn-primary" type="submit">Submit</button>
<button class="btn btn-secondary" type="button" id="clearBtn">Clear</button>
</div>

</form>

<p id="studentCount" style="text-align:center;margin-top:20px;font-size:12px"></p>
</div>
</div>

<div class="toast" id="toast"></div>
<div class="loading" id="loading">
<div class="loading-spinner"></div>
<p>Loading student database…</p>
</div>

<script>
const APPS_SCRIPT_URL =
"https://script.google.com/macros/s/AKfycbxiaRFpcRZPmZ6EGeSv4GqSvgoQgcP_pQAsI-Ox2zI8AlAuzyQf7f59PbfOfZIo7ujYHg/exec";

let studentDatabase=[],selectedStudent=null,selectedBlock="",selectedRoom="";

document.addEventListener("DOMContentLoaded",()=>{
  document.getElementById("auditDate").value=new Date().toISOString().split("T")[0];
  generateRooms();
  loadStudents();
});

async function loadStudents(){
  document.getElementById("loading").style.display="flex";
  try{
    const res=await fetch(APPS_SCRIPT_URL,{cache:"no-store"});
    const csv=await res.text();
    studentDatabase=parseCSV(csv);
    localStorage.setItem("students",JSON.stringify(studentDatabase));
    document.getElementById("studentCount").innerHTML=
      `<strong>${studentDatabase.length}</strong> students loaded`;
    showToast("Database loaded","success");
  }catch{
    const cache=localStorage.getItem("students");
    if(cache){
      studentDatabase=JSON.parse(cache);
      showToast("Loaded cached database","warning");
    }else{
      showToast("Database failed to load","error");
    }
  }
  document.getElementById("loading").style.display="none";
}

function parseCSV(text){
  const [h,...rows]=text.split("\n").filter(Boolean);
  const headers=h.split(",").map(x=>x.toLowerCase());
  return rows.map(r=>{
    const v=r.split(",");
    const s={};
    headers.forEach((h,i)=>s[h]=v[i]?.trim());
    return {
      id:s.id||s["student id"]||"",
      name:s.name||s["student name"]||"",
      level:s.level||"",
      programme:s.programme||"Medicine"
    };
  }).filter(s=>s.id&&s.name);
}

function generateRooms(){
  const g=document.getElementById("roomsGrid");
  for(let i=1;i<=40;i++){
    const d=document.createElement("div");
    d.className="room-btn";
    d.textContent=i;
    d.onclick=()=>{selectedRoom=i;};
    g.appendChild(d);
  }
}

function showToast(msg,type){
  const t=document.getElementById("toast");
  t.textContent=msg;
  t.style.background=
    type==="success"?"var(--accent)":
    type==="error"?"var(--danger)":"var(--warning)";
  t.classList.add("show");
  setTimeout(()=>t.classList.remove("show"),3000);
}
</script>
</body>
</html>
